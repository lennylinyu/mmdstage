!function(t){"use strict";void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:0<t?1:+t}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var s=arguments[i];if(null!=s)for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e});var h=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}}(),u=function(){function d(t,e,i,s,a,n){h(this,d),this.setValues(t,e,i,s,a,n)}return s(d,[{key:"setValues",value:function(t,e,i,s,a,n){return this.a=null==t?1:t,this.b=e||0,this.c=i||0,this.d=null==s?1:s,this.tx=a||0,this.ty=n||0,this}},{key:"append",value:function(t,e,i,s,a,n){var h=this.a,r=this.b,o=this.c,c=this.d;return 1==t&&0==e&&0==i&&1==s||(this.a=h*t+o*e,this.b=r*t+c*e,this.c=h*i+o*s,this.d=r*i+c*s),this.tx=h*a+o*n+this.tx,this.ty=r*a+c*n+this.ty,this}},{key:"prepend",value:function(t,e,i,s,a,n){var h=this.a,r=this.c,o=this.tx;return this.a=t*h+i*this.b,this.b=e*h+s*this.b,this.c=t*r+i*this.d,this.d=e*r+s*this.d,this.tx=t*o+i*this.ty+a,this.ty=e*o+s*this.ty+n,this}},{key:"appendMatrix",value:function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty)}},{key:"prependMatrix",value:function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty)}},{key:"appendTransform",value:function(t,e,i,s,a,n,h,r,o){if(a%360)var c=a*d.DEG_TO_RAD,u=Math.cos(c),l=Math.sin(c);else u=1,l=0;return n||h?(n*=d.DEG_TO_RAD,h*=d.DEG_TO_RAD,this.append(Math.cos(h),Math.sin(h),-Math.sin(n),Math.cos(n),t,e),this.append(u*i,l*i,-l*s,u*s,0,0)):this.append(u*i,l*i,-l*s,u*s,t,e),(r||o)&&(this.tx-=r*this.a+o*this.c,this.ty-=r*this.b+o*this.d),this}},{key:"prependTransform",value:function(t,e,i,s,a,n,h,r,o){if(a%360)var c=a*d.DEG_TO_RAD,u=Math.cos(c),l=Math.sin(c);else u=1,l=0;return(r||o)&&(this.tx-=r,this.ty-=o),n||h?(n*=d.DEG_TO_RAD,h*=d.DEG_TO_RAD,this.prepend(u*i,l*i,-l*s,u*s,0,0),this.prepend(Math.cos(h),Math.sin(h),-Math.sin(n),Math.cos(n),t,e)):this.prepend(u*i,l*i,-l*s,u*s,t,e),this}},{key:"rotate",value:function(t){t*=d.DEG_TO_RAD;var e=Math.cos(t),i=Math.sin(t),s=this.a,a=this.b;return this.a=s*e+this.c*i,this.b=a*e+this.d*i,this.c=-s*i+this.c*e,this.d=-a*i+this.d*e,this}},{key:"skew",value:function(t,e){return t*=d.DEG_TO_RAD,e*=d.DEG_TO_RAD,this.append(Math.cos(e),Math.sin(e),-Math.sin(t),Math.cos(t),0,0),this}},{key:"scale",value:function(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this}},{key:"translate",value:function(t,e){return this.tx+=this.a*t+this.c*e,this.ty+=this.b*t+this.d*e,this}},{key:"identity",value:function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this}},{key:"invert",value:function(){var t=this.a,e=this.b,i=this.c,s=this.d,a=this.tx,n=t*s-e*i;return this.a=s/n,this.b=-e/n,this.c=-i/n,this.d=t/n,this.tx=(i*this.ty-s*a)/n,this.ty=-(t*this.ty-e*a)/n,this}},{key:"isIdentity",value:function(){return 0===this.tx&&0===this.ty&&1===this.a&&0===this.b&&0===this.c&&1===this.d}},{key:"equals",value:function(t){return this.tx===t.tx&&this.ty===t.ty&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d}},{key:"transformPoint",value:function(t,e,i){return(i=i||{}).x=t*this.a+e*this.c+this.tx,i.y=t*this.b+e*this.d+this.ty,i}},{key:"decompose",value:function(t){null==t&&(t={}),t.x=this.tx,t.y=this.ty,t.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),t.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var e=Math.atan2(-this.c,this.d),i=Math.atan2(this.b,this.a);return Math.abs(1-e/i)<1e-5?(t.rotation=i/d.DEG_TO_RAD,this.a<0&&0<=this.d&&(t.rotation+=t.rotation<=0?180:-180),t.skewX=t.skewY=0):(t.skewX=e/d.DEG_TO_RAD,t.skewY=i/d.DEG_TO_RAD),t}},{key:"copy",value:function(t){return this.setValues(t.a,t.b,t.c,t.d,t.tx,t.ty)}},{key:"clone",value:function(){return new d(this.a,this.b,this.c,this.d,this.tx,this.ty)}},{key:"toString",value:function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"}}]),d}();u.DEG_TO_RAD=Math.PI/180,u.identity=null;var i=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;h(this,i),this.setSize(t,e)}return s(i,[{key:"setSize",value:function(t,e){this._width=t,this._height=e}},{key:"_exactFit",value:function(t,e){return{x:0,y:0,width:this.width,height:this.height,scaleX:t/this.width,scaleY:e/this.height,rotation:0}}},{key:"_noBorder",value:function(t,e){var i=1;return i=this.height/this.width<e/t?e/this.height:t/this.width,{x:0,y:0,width:this.width*i,height:this.height*i,scaleX:i,scaleY:i,rotation:0}}},{key:"_noScale",value:function(t,e){return{x:0,y:0,width:this.width,height:this.height,scaleX:1,scaleY:1,rotation:0}}},{key:"_showAll",value:function(t,e){var i=1;return i=this.height/this.width<e/t?t/this.width:e/this.height,{x:0,y:0,width:this.width*i,height:this.height*i,scaleX:i,scaleY:i,rotation:0}}},{key:"_exactWidth",value:function(t,e){var i;return i=t/this.width,{x:0,y:0,width:this.width*i,height:this.height*i,scaleX:i,scaleY:i,rotation:0}}},{key:"_exactHeight",value:function(t,e){var i;return i=e/this.height,{x:0,y:0,width:this.width*i,height:this.height*i,scaleX:i,scaleY:i,rotation:0}}},{key:"update",value:function(t,e,i){var s,a="h"==this.type.toLocaleLowerCase();if(a)if(0!=i)var n=t,h=e;else n=e,h=t;else if(0==i)n=t,h=e;else n=e,h=t;var r=!1;switch(this.scaleMode.toLowerCase()){case"exactfit":s=this._exactFit(n,h);break;case"noborder":r=!0,s=this._noBorder(n,h);break;case"noscale":r=!0,s=this._noScale(n,h);break;case"showall":r=!0,s=this._showAll(n,h);break;case"width":r=!0,s=this._exactWidth(n,h);break;case"height":r=!0,s=this._exactHeight(n,h);break;default:s={x:0,y:0,width:n,height:h,scaleX:1,scaleY:1,rotation:i}}if(a)switch(i){case-90:case 90:s.rotation=0;break;default:s.rotation=-90}else s.rotation=i;var o=-90!=s.rotation&&(!a||0!=s.rotation),c=1*(n-s.width),u=1*(h-s.height);if(r)switch(this.align.toLowerCase()){case"l":s.x=o&&0!=s.rotation?c:0,s.y=(h-s.height)/2;break;case"t":s.x=(n-s.width)/2,s.y=o?0:a?0!=s.rotation?u:0:u;break;case"r":s.x=o?n-s.width-(0==s.rotation?0:c):n-s.width,s.y=(h-s.height)/2;break;case"b":s.x=(n-s.width)/2,s.y=o?h-s.height:a?0!=s.rotation?0:u:0;break;case"lt":case"tl":s.x=o&&0!=s.rotation?c:0,s.y=o?0:a?0!=s.rotation?u:0:u;break;case"tr":case"rt":s.x=o?n-s.width-(0==s.rotation?0:c):n-s.width,s.y=o?0:a?0!=s.rotation?u:0:u;break;case"bl":case"lb":s.x=o&&0!=s.rotation?c:0,s.y=o?h-s.height:a?0!=s.rotation?0:u:0;break;case"br":case"rb":s.x=o?n-s.width-(0==s.rotation?0:c):n-s.width,s.y=o?h-s.height:a?0!=s.rotation?0:u:0;break;default:s.x=(n-s.width)/2,s.y=(h-s.height)/2}if(0!=s.rotation){var l=s.x,d=s.y;-90==s.rotation?(s.x=s.scaleY*this.height+d,s.y=l):(s.y=s.scaleX*this.width+l,s.x=d)}return s.stageWidth=n,s.stageHeight=h,s}},{key:"type",set:function(t){this._type=t},get:function(){return this._type}},{key:"align",set:function(t){this._align=t},get:function(){return this._align}},{key:"scaleMode",set:function(t){this._scaleMode=t},get:function(){return this._scaleMode}},{key:"width",set:function(t){this._width=t},get:function(){return this._width}},{key:"height",set:function(t){this._height=t},get:function(){return this._height}}]),i}();i.EXACT_FIT="exactfit",i.NO_BORDER="noborder",i.NO_SCALE="noscale",i.SHOW_ALL="showall",i.WIDTH="width",i.HEIGHT="height";var a={width:400,height:400,scale:"exactfit",rotation:"auto",align:"",mode:"v"},n=function(){function e(t){h(this,e),this.matrix=new u,this._stage=new i(a.width,a.height),this.target=t}return s(e,[{key:"update",value:function(t,e,i){if("v"==this.options.rotation.toLocaleLowerCase()&&(this.target.style.display=0!=i?"none":"block"),"h"==this.options.rotation.toLocaleLowerCase()&&(this.target.style.display=0==i?"none":"block"),"auto"==this.options.rotation.toLocaleLowerCase()&&(this.target.style.display="block"),"block"==this.target.style.display){var s,a,n,h,r=this._stage.update(t,e,i),o=new u;o.rotate(-r.rotation),o.tx=r.x,o.ty=r.y,o.scale(r.scaleX,r.scaleY),this.matrix=o,this._sendEvent(this.target,"rectangle",r),s=this.target.style,a=this.matrix,n=1e4,h="matrix3d("+(a.a*n|0)/n+","+(a.b*n|0)/n+",0,0,"+(a.c*n|0)/n+","+(a.d*n|0)/n+",0,0,0,0,1,0,"+(a.tx+.5|0)+","+(a.ty+.5|0)+",0,1)",s.transform=s.WebkitTransform=s.OTransform=s.msTransform=h;var c=this._parsePoint(this.options.width,this.options.height,r.x,r.y,r,this.align);this._sendEvent(this.target,"position",c),this._updatChild(r)}}},{key:"_sendEvent",value:function(t,e,i){if(document.createEvent){var s=document.createEvent("Event");s.initEvent(e,!0,!0),s.data=i,t.dispatchEvent(s)}}},{key:"_parsePoint",value:function(t,e,i,s,a,n){var h,r,o,c,u,l;switch(a.rotation){case 0:u=-a.y/a.scaleY,c=(o=-a.x/a.scaleX)+a.stageWidth/a.scaleX,l=u+a.stageHeight/a.scaleY;break;case-90:u=-(a.stageHeight-a.x)/a.scaleX,c=(o=-a.y/a.scaleY)+a.stageWidth/a.scaleX,l=u+a.stageHeight/a.scaleY;break;case 90:o=-(a.stageWidth-a.y)/a.scaleY,u=-a.x/a.scaleX,c=o+a.stageWidth/a.scaleY,l=u+a.stageHeight/a.scaleX}if(h=o+(c-o)/2,r=u+(l-u)/2,void 0!==n){switch(n.toLocaleLowerCase()){case"t":r=u;break;case"l":h=o;break;case"r":h=c;break;case"b":r=l;break;case"tl":case"lt":h=o,r=u;break;case"tr":case"rt":h=c,r=u;break;case"bl":case"lb":h=o,r=l;break;case"rb":case"br":h=c,r=l}child.style.top=r-e/2+s+"px",child.style.left=h-t/2+i+"px"}return{x:h,y:r,top:u,left:o,right:c,bottom:l}}},{key:"_updatChild",value:function(t){if(this.target){var e,i,s,a,n,h,r,o,c,u,l,d,g,y=this.target.childNodes;a="h"==this._stage.type.toLocaleLowerCase();for(var f=0;f<y.length;f++)if((n=y[f]).getAttribute){s=n.hasAttribute("view-align")?n.getAttribute("view-align")?n.getAttribute("view-align"):"":void 0,d=Number(n.getAttribute("view-width"))||0,g=Number(n.getAttribute("view-height"))||0,e=Number(n.getAttribute("view-x"))||0,i=Number(n.getAttribute("view-y"))||0;var v=this._parsePoint(d,g,e,i,t,s);if(void 0!==s&&(n.style.top=v.y-g/2+i+"px",n.style.left=v.x-d/2+e+"px"),a)switch(t.rotation){case-90:case 90:o=-t.y/t.scaleY,u=-(t.stageHeight-t.x)/t.scaleX,c=o+t.stageWidth/t.scaleX,l=u+t.stageHeight/t.scaleY;break;case 0:o=-t.x/t.scaleX,u=-t.y/t.scaleY,c=o+t.stageWidth/t.scaleX,l=u+t.stageHeight/t.scaleX}else switch(t.rotation){case 0:u=-t.y/t.scaleY,c=(o=-t.x/t.scaleX)+t.stageWidth/t.scaleX,l=u+t.stageHeight/t.scaleY;break;case-90:u=-(t.stageHeight-t.x)/t.scaleX,c=(o=-t.y/t.scaleY)+t.stageWidth/t.scaleX,l=u+t.stageHeight/t.scaleY;break;case 90:o=-(t.stageWidth-t.y)/t.scaleY,u=-t.x/t.scaleX,c=o+t.stageWidth/t.scaleY,l=u+t.stageHeight/t.scaleX}if(h=o+(c-o)/2,r=u+(l-u)/2,void 0!==s){switch(s.toLocaleLowerCase()){case"t":r=u;break;case"l":h=o;break;case"r":h=c;break;case"b":r=l;break;case"tl":case"lt":h=o,r=u;break;case"tr":case"rt":h=c,r=u;break;case"bl":case"lb":h=o,r=l;break;case"rb":case"br":h=c,r=l}n.style.top=r-g/2+i+"px",n.style.left=h-d/2+e+"px"}this._sendEvent(n,"position",{target:n,top:u,left:o,right:c,bottom:l})}}}},{key:"options",set:function(t){this._options=t,this.target&&(this.target.setAttribute("view-width",t.width),this.target.setAttribute("view-height",t.height),this.target.setAttribute("view-scale",t.scale),this.target.setAttribute("view-rotation",t.rotation),this.target.setAttribute("view-align",t.align),this.target.setAttribute("view-mode",t.mode)),this._stage.width=this.options.width,this._stage.height=this.options.height,this._stage.align=this.options.align,this._stage.scaleMode=this.options.scale,this._stage.type=t.mode},get:function(){return this._options}},{key:"matrix",set:function(t){this._matrix=t},get:function(){return this._matrix}},{key:"parent",set:function(t){this._parent=t},get:function(){return this._parent}},{key:"target",set:function(t){if(this._target=t){t.style.position="absolute",t.style.transformOrigin=t.style.WebkitTransformOrigin=t.style.msTransformOrigin=t.style.MozTransformOrigin=t.style.OTransformOrigin="0% 0%";var e={width:Number(t.getAttribute("view-width")),height:Number(t.getAttribute("view-height")),scale:t.getAttribute("view-scale"),rotation:t.getAttribute("view-rotation"),align:t.getAttribute("view-align"),mode:t.getAttribute("view-mode")};for(var i in e)e[i]||(e[i]=a[i]);t.style.width=e.width+"px",t.style.height=e.height+"px",t.style.overflow="hidden",this.options=e}},get:function(){return this._target}}]),e}(),r=function t(){var e=this;h(this,t);var i=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(t){return e[t]=function(){return i[t].apply(i,arguments)}})},e=function(t){function e(){h(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.init(),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r),s(e,[{key:"init",value:function(){this._list=[],this._orientation=window.orientation||0,addEventListener("DOMContentLoaded",this._onContentLoaded.bind(this)),addEventListener("orientationchange",this._onOrientation.bind(this)),addEventListener("resize",this._onResize.bind(this))}},{key:"_onOrientation",value:function(){this.createTime()}},{key:"_onResize",value:function(){window.innerWidth<window.innerHeight?this._orientation=0:this._orientation=90,this._onOrientation(),this.createTime()}},{key:"_onContentLoaded",value:function(){addEventListener("DOMNodeInserted",this._onInserted.bind(this)),addEventListener("DOMNodeRemoved",this._onRemoved.bind(this)),this._onInserted({target:document.body})}},{key:"_onRemoved",value:function(t){this._removeItem(t.target)}},{key:"_onInserted",value:function(t){this._checkNodes(t.target)}},{key:"_checkNodes",value:function(t){var e=t.childNodes;if(t.getAttribute&&(t.getAttribute("view-mode")&&!this._checkItem(t)&&this._checkParent(t))){try{var i=new n(t)}catch(t){}this._addItem(i)}for(var s=0;s<e.length;s++){i=t.childNodes[s];this._checkNodes(i)}}},{key:"_checkParent",value:function(t){var e=t.parentNode;return!e||e==document||!e.getAttribute("view-mode")&&this._checkParent(e)}},{key:"_addItem",value:function(t){this._removeItem(t),this._list.push(t),void 0===window.orientation&&(window.innerWidth<window.innerHeight?this._orientation=0:this._orientation=90),this.createTime()}},{key:"_checkItem",value:function(t){for(var e=0;e<this._list.length;e++)if(this._list[e].target==t)return!0;return!1}},{key:"_removeItem",value:function(t){for(var e=0;e<this._list.length;e++)if(this._list[e].target==t)return void this._list.slice(e,1)}},{key:"_update",value:function(){window.innerWidth<window.innerHeight?this._orientation=0:this._orientation=90;for(var t=window.innerWidth,e=window.innerHeight,i=0;i<this._list.length;i++){this._list[i].update(t,e,this._orientation)}}},{key:"createTime",value:function(){var t=this;clearTimeout(this._tid);var e=0;this._tid=setInterval(function(){t._update(),10<++e&&clearTimeout(t._tid)},100),this._update()}},{key:"orientation",get:function(){return this._orientation}}],[{key:"getInstance",value:function(){return e._instance?e._instance:e._instance=new e}}]),e}();e._instance=null,e.getInstance(),t.DomLayout=e}(this.MMD=this.MMD||{});
